<div class="mx-auto max-w-screen-xl px-4 sm:px-6 lg:px-8 py-4 sm:py-6">

  <!-- Search Input Area -->
  <div class="bg-white dark:bg-slate-800 p-6 rounded-lg shadow-lg mb-8">
    <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-4 text-center">Search Forum</h2>
    <form (ngSubmit)="performSearch()" class="space-y-4">
      <!-- Search Type Options -->
      <fieldset class="flex justify-center">
        <legend class="sr-only">Search Type</legend>
        <div>
          <input type="radio" name="SearchType" value="discussion" id="SearchDiscussion" class="peer hidden" [(ngModel)]="searchType" checked />
          <label for="SearchDiscussion"
                 class="flex cursor-pointer items-center justify-center rounded-l-md border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-2 py-2 text-gray-900 dark:text-slate-200 hover:border-gray-200 dark:hover:border-slate-600 peer-checked:border-yellow-600 peer-checked:bg-yellow-600 peer-checked:text-white">
            <p class="text-xs font-bold">Discussions</p>
          </label>
        </div>
        <div>
          <input type="radio" name="SearchType" value="comment" id="SearchComment" class="peer hidden" [(ngModel)]="searchType" />
          <label for="SearchComment"
                 class="flex cursor-pointer items-center justify-center rounded-r-md border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-2 py-2 text-gray-900 dark:text-slate-200 hover:border-gray-200 dark:hover:border-slate-600 peer-checked:border-yellow-600 peer-checked:bg-yellow-600 peer-checked:text-white">
            <p class="text-xs font-bold">Comments</p>
          </label>
        </div>
      </fieldset>

      <!-- Keyword Input -->
      <div>
        <label for="keyword" class="sr-only">Search Keyword</label>
        <input type="text" id="keyword" name="keyword" [(ngModel)]="keyword" required
               class="block w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-slate-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-slate-700 text-gray-900 dark:text-slate-200"
               placeholder="Enter keywords..."
        />
      </div>

      <!-- Search Button -->
      <div class="flex justify-center">
        <button type="submit" [disabled]="isLoading"
                class="inline-block rounded-lg bg-indigo-600 px-8 py-3 text-sm font-medium text-white hover:bg-indigo-700 disabled:bg-blue-400 disabled:cursor-not-allowed cursor-pointer">
          <span *ngIf="!isLoading">Search</span>
          <span *ngIf="isLoading" class="flex items-center">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Searching...
          </span>
        </button>
      </div>
    </form>
  </div>

  <!-- Search Results Area -->
  <div *ngIf="searchPerformed" class="mt-8">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex justify-center items-center py-10">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
      <p class="ml-3 text-lg text-gray-600">Searching...</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="error && !isLoading" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md shadow-md" role="alert">
      <p class="font-bold">Error</p>
      <p>{{ error }}</p>
    </div>

    <!-- Results -->
    <div *ngIf="activeResultsPage && !isLoading && !error">
      <!-- Results Header -->
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-semibold text-gray-800 dark:text-slate-100">
          Search Results
        </h3>
        <p class="text-sm text-gray-600 dark:text-slate-400">
          Found {{ activeResultsPage.totalElements }} results
        </p>
      </div>

      <!-- No Results Message -->
      <div *ngIf="activeResultsPage.empty" class="text-center py-10 bg-gray-50 dark:bg-slate-700 rounded-lg">
        <ng-icon name="heroMagnifyingGlass" size="3rem" class="mx-auto text-gray-400"></ng-icon>
        <p class="mt-2 text-lg text-gray-500 dark:text-slate-400">No results found for "{{ keyword }}".</p>
        <p class="text-sm text-gray-400 dark:text-slate-500">Try searching for something else.</p>
      </div>

      <!-- Discussion Results List -->
      <div *ngIf="searchType === 'discussion' && discussionResultsPage && !discussionResultsPage.empty" class="space-y-4">
        <div *ngFor="let result of discussionResultsPage.content"
             class="bg-white dark:bg-slate-700 p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow">
          <a [routerLink]="['/app/discussions', result.discussionId, 'view']"
             class="text-lg font-semibold text-indigo-600 hover:underline dark:text-indigo-400">
            {{ result.title }}
          </a>
          <p class="text-sm text-gray-500 dark:text-slate-400 mt-1">
            By {{ result.discussionCreator }} on {{ result.discussionCreateDate | date:'mediumDate' }}
          </p>
          <p class="mt-2 text-gray-700 dark:text-slate-300 text-sm">
            {{ result.contentAbbr }}...
          </p>
        </div>
      </div>

      <!-- Comment Results List -->
      <div *ngIf="searchType === 'comment' && commentResultsPage && !commentResultsPage.empty" class="space-y-4">
        <div *ngFor="let result of commentResultsPage.content"
             class="bg-white dark:bg-slate-700 p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow">
          <a [routerLink]="['/app/comments', result.id, 'thread']"
             class="text-lg font-semibold text-indigo-600 hover:underline dark:text-indigo-400">
            {{ result.title }}
          </a>
          <p class="text-sm text-gray-500 dark:text-slate-400 mt-1">
            By {{ result.createBy }} on {{ result.createDate | date:'mediumDate' }}
          </p>
          <p class="mt-2 text-gray-700 dark:text-slate-300 text-sm">
            {{ result.content | slice:0:255 }}...
          </p>
        </div>
      </div>

      <!-- Pagination Controls -->
      <nav *ngIf="activeResultsPage && !activeResultsPage.empty && activeResultsPage.totalPages > 1"
           class="mt-6 flex items-center justify-between border-t border-gray-200 dark:border-slate-600 px-4 py-3 sm:px-0"
           aria-label="Search Results Pagination">
        <div class="hidden sm:block">
          <p class="text-sm text-gray-700 dark:text-gray-300">
            Showing
            <span class="font-medium">{{ activeResultsPage.number * activeResultsPage.size + 1 }}</span>
            to
            <span class="font-medium">{{ activeResultsPage.number * activeResultsPage.size + activeResultsPage.numberOfElements }}</span>
            of
            <span class="font-medium">{{ activeResultsPage.totalElements }}</span>
            results
          </p>
        </div>
        <div class="flex-1 flex justify-between sm:justify-end items-center space-x-1">
          <button (click)="goToPage(activeResultsPage.number - 1)"
                  [disabled]="activeResultsPage.first || isLoading"
                  class="relative inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 dark:bg-slate-700 dark:text-gray-300 dark:hover:bg-slate-600">
            Prev
          </button>
          <ng-container *ngFor="let pageNum of displayablePageNumbers">
            <button *ngIf="pageNum !== -1"
                    (click)="goToPage(pageNum)"
                    [disabled]="isLoading"
                    [ngClass]="{'z-10 bg-indigo-50 border-indigo-500 text-indigo-600 dark:bg-indigo-600 dark:text-white dark:border-indigo-500': pageNum === activeResultsPage.number, 'bg-white border-gray-300 text-gray-500 hover:bg-gray-50 dark:bg-slate-700 dark:text-gray-300 dark:border-slate-500 dark:hover:bg-slate-600': pageNum !== activeResultsPage.number}"
                    class="relative inline-flex items-center px-3 py-1.5 border text-sm font-medium">
              {{ pageNum + 1 }}
            </button>
            <span *ngIf="pageNum === -1" class="relative inline-flex items-center px-3 py-1.5 border border-gray-300 bg-white text-sm font-medium text-gray-700 dark:bg-slate-700 dark:text-gray-300 dark:border-slate-500">...</span>
          </ng-container>
          <button (click)="goToPage(activeResultsPage.number + 1)"
                  [disabled]="activeResultsPage.last || isLoading"
                  class="relative inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 dark:bg-slate-700 dark:text-gray-300 dark:hover:bg-slate-600">
            Next
          </button>
        </div>
      </nav>

    </div>
  </div>
</div>
