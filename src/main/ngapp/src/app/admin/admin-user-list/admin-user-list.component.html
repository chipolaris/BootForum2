<div class="mx-auto max-w-screen-xl px-4 sm:px-6 lg:px-8 py-4 sm:py-6">
  <p-toast></p-toast>
  <header class="mb-6">
    <h1 class="text-3xl font-bold text-slate-800 dark:text-slate-100">User Management</h1>
    <p class="text-slate-600 dark:text-slate-300 mt-1">View, edit roles, and manage user accounts.</p>
  </header>

  <div class="card">
    <p-table [value]="users" [lazy]="true" (onLazyLoad)="loadUsers($event)" [paginator]="true" [rows]="10"
             [totalRecords]="totalRecords" [loading]="loading" dataKey="id"
             [showCurrentPageReport]="true" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
             stripedRows [tableStyle]="{'min-width': '60rem'}"
             [rowsPerPageOptions]="[10, 25, 50]">
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="username">Username <p-sortIcon field="username"></p-sortIcon></th>
          <th pSortableColumn="firstName">First Name <p-sortIcon field="firstName"></p-sortIcon></th>
          <th pSortableColumn="lastName">Last Name <p-sortIcon field="lastName"></p-sortIcon></th>
          <th>Roles</th>
          <th pSortableColumn="accountStatus">Status <p-sortIcon field="accountStatus"></p-sortIcon></th>
          <th pSortableColumn="lastLogin">Last Login <p-sortIcon field="lastLogin"></p-sortIcon></th>
          <th style="width: 6rem">Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-user>
        <tr>
          <td>{{ user.username }}</td>
          <td>{{ user.firstName }}</td>
          <td>{{ user.lastName }}</td>
          <td>
            <div class="flex flex-wrap gap-1">
              <p-tag *ngFor="let role of user.roles" [value]="role" severity="info"></p-tag>
            </div>
          </td>
          <td>
            <p-tag [value]="user.accountStatus" [severity]="getStatusSeverity(user.accountStatus)"></p-tag>
          </td>
          <td>{{ user.lastLogin | date:'medium' }}</td>
          <td>
            <button pButton pRipple type="button" icon="pi pi-pencil" class="p-button-rounded p-button-text"
                    (click)="openEditDialog(user)" pTooltip="Edit User"></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center p-8">No users found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
