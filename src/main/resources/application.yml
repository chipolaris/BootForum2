spring:
  application:
    name: BootForum2
  # Set the default profile (can be overridden at runtime)
  profiles:
    active: dev
  datasource:
    url: jdbc:h2:file:${user.home}/BootForum2/h2/data;DB_CLOSE_DELAY=-1
    driverClassName: org.h2.Driver
    username: sa
    password: secret
  h2:
    console:
      enabled: true
      path: /h2-console
  jpa:
    hibernate:
      ddl-auto: update
    # REMOVE THE FOLLOWING LINE - It is causing the timing issue
    # defer-datasource-initialization: true
    show-sql: true
    properties:
      hibernate:
        search:
          backend:
            type: lucene
            directory:
              root: ${user.home}/BootForum2/data/lucene/indexes
              # This is often the default for Lucene but good to be explicit
              type: local-filesystem
          automatic_indexing:
            synchronization:
              strategy: sync
          schema_management:
            strategy: create-or-update
  sql:
    init:
      # spring.sql.init.mode controls whether to run the SQL files such as resources/schema.sql on application starts up
      # Google says spring.sql.init.mode=always is the default, but somehow, data.sql is not executed
      # Therefore, explicitly set it to always to force execution of data.sql
      mode: never

server:
  servlet:
    context-path: /

#
# Note: when starting the application for the very first time, remember to
# set the following properties to force the creation of SQL schema and run
# data initialization script (data.sql):
#    spring.jpa.hibernate.ddl-auto=update
#    # spring.jpa.defer-datasource-initialization=true # This is only needed if sql.init.mode is 'always'
#    spring.sql.init.mode=always
#

#
# JWT Configuration
#
app:
  jwt:
    # Generate a strong, base64 encoded secret key (e.g., using online tools or code)
    # Example ONLY - Replace with a real, secure key! Must be long enough for HS512 (at least 64 bytes / 512 bits).
    # Use a secure random generator to create this.
    # The following is generated by online base64 random generator
    secret: m9xrhxgLm4EVnncZOyX8JHPseZ050/ax2ljsdm1bj3soVDusLIgPUSCsvVHUm+SvNlKUFkiFlpxybM7rUecIAQ==
    # Token validity in milliseconds (e.g., 1 hour = 3600000, 1 day = 86400000)
    expiration-ms: 3600000

# File storage configuration
file:
  storage:
    base-path: ${user.home}/BootForum2/uploads

# Spring Actuator Health Check ---
management:
  endpoints:
    web:
      exposure:
        include: health # Expose the health endpoint over the web
  endpoint:
    health:
      # Configure when to show details. 'when_authorized' is a secure default.
      # Our custom controller will decide what to show publicly.
      show-details: when_authorized
      show-components: when_authorized

logging:
  level:
    org:
      springframework:
        security: DEBUG
        boot:
          autoconfigure:
            jdbc: DEBUG
      hibernate:
        search: INFO